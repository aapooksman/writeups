import socket
import ssl

# Listen for TCP connections
listener = socket.socket()
listener.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
listener.bind(("127.0.0.1", 12345))
listener.listen(5)
conn, address = listener.accept()

# Create a TLS context that checks the client certificate
ctx = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)
ctx.verify_mode = ssl.CERT_REQUIRED
ctx.load_verify_locations(cafile="server.crt")
ctx.load_cert_chain(certfile="server.crt", keyfile="server.key")

# Wrap the TCP connection with TLS
tls_socket = ctx.wrap_socket(conn, server_side=True)

# Receive data from the authenticated and secure TLS connection
print(tls_socket.recv(4096))
